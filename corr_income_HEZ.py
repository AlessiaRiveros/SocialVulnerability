import os
import pandas as pd
import geopandas as gpd
import numpy as np

pdir = r'p:\11209200-020-sociale-kwetsbaarheid\Data'

azone = gpd.read_file(os.path.join(pdir, 'Income', 'AZONE.shp'))
inc = pd.read_excel(os.path.join(pdir, 'Income', 'Income.xlsx'))
hez = gpd.read_file(os.path.join(pdir, 'ZEH_2021', 'ZONAS_ECON_HOM.shp'))

# drop columns
hez = hez.drop(columns=['OID_', 'FolderPath', 'SymbolID', 'AltMode', 'Base', 'Clamped', 'Extruded', 'Snippet', 'PopupInfo'])

# create ID based on Name Z-..
pattern = r'(\d+)'
hez['IDhez'] = hez['Name'].str.extract(pattern).astype('Int64')

# add valor del pavimento asfaltado
hez_values = {
    1: 1978.80,
    2: 1414.81,
    3: 1113.37,
    4: 903.82,
    5: 819.46,
    6: 676.45,
    7: 453.12,
    8: 310.93,
    9: 200.08,
    10: 98.70,
    11: 70.86,
    12: 58.41,
    13: 34.00,
    14: 28.79,
    15: 23.78,
    16: 23.78,
    17: 23.78,
    18: 23.78
}

hez = hez.sort_values(by=['IDhez'])
hez["Value"] = hez.IDhez.map(hez_values)

# ingresos mensuales por hogar
R = np.array([1500, 3000, 5000, 7000, 9000, 11000, 13000, 14500])

# income per AZONE
inc['incperazone'] = (inc['R1'] * R[0] + inc['R2'] * R[1] + inc['R3'] * R[2] + inc['R4'] * R[3] + inc['R5'] * R[4] \
                          + inc['R6'] * R[5] + inc['R7'] * R[6] + inc['R8'] * R[7]) / inc['Total']
inc = inc.rename(columns={"AZONE": "ID"})

azone = azone.merge(inc, on='ID')