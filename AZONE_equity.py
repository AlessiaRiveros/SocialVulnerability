import os
import pandas as pd
import numpy as np

pdir = r'p:\11209200-020-sociale-kwetsbaarheid\Data\Income'

inc = pd.read_excel(os.path.join(pdir, 'Income.xlsx'), sheet_name="AZONE", index_col="AZONE")
pop = pd.read_csv(os.path.join(pdir, 'AZONEwithPop16.csv'), index_col="IDazone")

# configurations
peopleperhh = 4
# R income information
R = np.array([1500, 2500, 4500, 6500, 8500, 10500, 12500, 14500]) / peopleperhh * 12  # [months/year]
# equity weight gamma
gamma = 1.2

# rename index
inc.index.names = ["ID"]
pop.index.names = ["ID"]

# fraction population interviewed
inc['frpopint'] = inc['Total'] * peopleperhh / pop['POP16']

# total population
totpop = pop.sum().item()
# income per capita per year per AZONE
inc['incpercapperyear'] = (inc['R1'] * R[0] + inc['R2'] * R[1] + inc['R3'] * R[2] + inc['R4'] * R[3] + inc['R5'] * R[4] \
                          + inc['R6'] * R[5] + inc['R7'] * R[6] + inc['R8'] * R[7]) / inc['Total']

# income per capita per year in the whole area
inc['incperyear'] = inc['incpercapperyear'] * pop['POP16']
totincpercapperyear = inc['incperyear'].sum() / totpop

# equity weight
inc['EW'] = (inc['incpercapperyear'] / totincpercapperyear)**-gamma

inc.to_csv(os.path.join(pdir, 'AZONEwithEW.csv'))