import geopandas as gpd
import os
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from shapely.geometry import box

pdir = r'p:\11209200-020-sociale-kwetsbaarheid'

# ----------------- configurations -----------------
# T=2 or T=10
T = '2'

# ----------------- load data -----------------
if T == '10':
    var = '20230405155643'
elif T == '2':
    var = '20230405154342'
else:
    print('Only damages for T=2 and T=10 have been calculated')

df = gpd.read_file(os.path.join(pdir, 'Data', 'FIAT', f't{T}_d120_20cm_groundfloorheight_{var}_results.shp'))

# only keep residential
df = df[df['PriObjType'] == 'Residential']

# check for nan values
print(df['TD_E'].isna().sum())

# count how many non 0 => affected buildings
# still not sure how to account for hh instead of buildings
buildings_a = df['TD_E'].astype(bool).sum(axis=0)
f_a = buildings_a / len(df)
print(f'Residential buildings affected: {buildings_a} \nTotal buildings considered: {len(df)} \nFraction affected: {f_a}')

# for T=10
# Residential buildings affected: 25345
# Total buildings considered: 646877
# Fraction affected: 0.039180555190554

# T=2
# Residential buildings affected: 10168
# Total buildings considered: 646877
# Fraction affected: 0.015718598744429