pdir = r'p:\11210264-001-just-equitable-paths\wellbeing'

T1 = 50
T2 = 100
# SOURCE = "asphalt_based"  # or "income_based" or "uniform"
# SOURCE = "income_based"
SOURCE = "asphalt_based"
FIAT = "ead_current_pluvial_10cm_20240501173244_results.shp"

EXTENT = "full_extent" # or "full_extent" or "inner_ring"
METHOD = "total" 


rule all:
    input:
        # pdir + "/data"+ "/3-input" + "/EW" + f"/{SOURCE}" + f"/database.csv"
        pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{T1}_heatmap_ranking.png"

rule resample_FIAT:  # this will change for the income based max pot instead of asphalt based max pot
    input:
        fiat_shp = pdir + "/data"+ "/1-external" + "/FIAT" + f"/{SOURCE}" + f"/{FIAT}",
        azone_shp = pdir + "/data"+ "/1-external" + "/Income" + "/AZONE.shp"
    output:
        fiat_csv = pdir + "/data" + "/2-interim" + "/FIAT" + f"/{SOURCE}" + f"/fiat_azone.csv"
    script: 
        "1-prepare/resample_FIAT_to_AZONE_v2.py"

rule resample_pop:
    input:
        uvzone_shp = pdir + "/data" + "/1-external" + "/population" + "/UVZONE.shp",
        azone_shp = pdir + "/data"+ "/1-external" + "/income" + "/AZONE.shp"
    output:
        pop_csv = pdir + "/data"+ "/2-interim" + "/population" + "/pop2016_azone.csv",
        pop_png = pdir + "/reports" + "/figures" + "/population" + "/population2016.png"
    script:
        "1-prepare/resample_UVZONE_to_AZONE.py"

rule income: # compare HEZ values with income values 
    input:
        azone_shp = pdir + "/data"+ "/1-external" + "/income" + "/AZONE.shp",
        inc_csv = pdir + "/data"+ "/1-external" + "/income" + "/Income.csv",
        hez_shp = pdir + "/data"+ "/1-external" + "/ZEH" + "/ZONAS_ECON_HOM.shp",
        districts_shp = pdir + "/data" + "/1-external" + "/population" + "/INEDistritos.shp"
    # params:
    #     hez_type = HEZ_TYPE
    output:
        inc_csv = pdir + "/data"+ "/2-interim" + "/income" + "/income.csv",
        inc_hez_png = pdir + "/reports" + "/figures" + "/income" + "/inc_hez.png",
        scatterplot_png = pdir + "/reports" + "/figures" + "/income" + "/scatterplot_corr.png",
        histogram_png =  pdir + "/reports" + "/figures" + "/income" + "/histogram.png",
        districts_png =  pdir + "/reports" + "/figures" + "/income" + "/districts.png",
        scatterplot_color_png = pdir + "/reports" + "/figures" + "/income" + "/scatterplot_corr_color.png",
        heatmap_png = pdir + "/reports" + "/figures" + "/income" + "/heatmap.png",
        outliers_png = pdir + "/reports" + "/figures" + "/income" + "/outliers.png"
    script:
        "1-prepare/correlation_income_HEZ.py"

rule model_EW:  # this will change for the income based max pot instead of asphalt based max pot
    input:
        fiat_csv = pdir + "/data"+ "/2-interim" + "/FIAT" + f"/{SOURCE}" + f"/fiat_azone.csv",
        inc_csv = pdir + "/data"+ "/2-interim" + "/income" + "/income.csv",
        pop_csv = pdir + "/data"+ "/2-interim" + "/population"  + "/pop2016_azone.csv"
    params:
        method = METHOD
    output:
        csv = pdir + "/data"+ "/3-input" + "/EW" + f"/{SOURCE}" + f"/database.csv"  # here comes the issue!
    script:
        "2-build/calculate_AZONE_EW_v2.py"

# rule plot_differences:  # this will change for the income based max pot instead of asphalt based max pot
#     input:
#         azone_shp = pdir + "/data"+ "/1-external" + "/income" + "/AZONE.shp",
#         ew_csv = pdir + "/data"+ "/3-input" + "/EW" + f"/{SOURCE}" + f"/{T}_database.csv"
#     params:
#         # t = T,
#         extent = EXTENT,
#         method = METHOD
#     output:
#         maps_png = pdir +  "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{METHOD}" + f"/{T}_{EXTENT}_difference_map_income.png",
#         barchart_png = pdir +  "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{METHOD}" +  f"/{T}_{EXTENT}_barchart_income.png"
#     script:
#         "5-visualize/visualize_maps.py"

rule policy_ranking:  # this will change for the income based max pot instead of asphalt based max pot
    input:
        azone_shp = pdir + "/data"+ "/1-external" + "/income" + "/AZONE.shp",
        ew_csv = pdir + "/data"+ "/3-input" + "/EW" + f"/{SOURCE}" + f"/database.csv"
    params:
        method = METHOD
    output:
        heatmap_T1 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{T1}_heatmap_ranking.png",
        heatmap_T2 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{T2}_heatmap_ranking.png",
        heatmap_quantile_T1 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{T1}_heatmap_quantile_ranking.png",
        heatmap_quantile_T2 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}" + f"/{T2}_heatmap_quantile_ranking.png",
        map_T1 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}"  + f"/{T1}_map_ranking.png",
        map_T2 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}"  + f"/{T2}_map_ranking.png",
        map_inc = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}"  + f"/map_income.png",
        diff_T1 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}"  + f"/{T1}_diff_map.png",
        diff_T2 = pdir + "/reports" + "/figures" + "/EW" + f"/{SOURCE}"  + f"/{T2}_diff_map.png"
    script:
        "5-visualize/visualize_EW_results.py"

