import pandas as pd
import os
import geopandas as gpd

pdir = r'p:\11209200-020-sociale-kwetsbaarheid\Data\FIAT'

T = '2'
building_type = 'residential'

if T == '10':
    var = '20230405155643'
elif T == '2':
    var = '20230405154342'

gdf = gpd.read_file(os.path.join(pdir, f't{T}_d120_20cm_groundfloorheight_{var}_results.shp'))
df = pd.DataFrame(gdf)
df = df[['PriObjType', 'PotDamStr', 'PotDamCon', 'PotDamOth', 'Etuv', 'TD_E']]
# drop where Etuv is nan
df = df.dropna(subset=['Etuv'])
# only focus on residential areas
if building_type == 'residential':
    df = df[df['PriObjType'] == 'Residential']
elif building_type == "all":
    df
elif building_type == "Commercial":
    df = df[df['PriObjType'] == 'Commercial']
print(df)
df = df.fillna(0)
df['TotPotDam'] = df['PotDamStr'] + df['PotDamCon'] + df['PotDamOth']
df = df[['Etuv', 'TotPotDam', 'TD_E']].groupby(['Etuv']).sum()
df['RelDam'] = df['TD_E'] / df["TotPotDam"]
df.to_csv(os.path.join(pdir, f't{T}_d120_20cm_groundfloorheight_{building_type}_aggregated.csv'))