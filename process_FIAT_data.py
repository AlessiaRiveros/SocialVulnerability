import pandas as pd
import os
import geopandas as gpd

pdir = r'p:\11209200-020-sociale-kwetsbaarheid\Data\FIAT'

T = '10'
if T == '10':
    var = '20230405155643'
elif T == '2':
    var = '20230405154342'

gdf = gpd.read_file(os.path.join(pdir, f't{T}_d120_20cm_groundfloorheight_{var}_results.shp'))
df = pd.DataFrame(gdf)
# drop where Etuv is nan
df = df.dropna(subset=['Etuv'])
# only focus on residential areas
df = df[df['PriObjType'] == 'Residential']
df['TotalDamages'] = df['PotDamStr'] + df['PotDamCon'] + df['PotDamOth']
df[['Etuv', 'TotalDamages']].groupby(['Etuv']).sum()
df.to_csv(os.path.join(pdir, 't' + T + '_d120_20cm_groundfloorheight_residential_aggregated.csv'),
          columns=['Etuv', 'TotalDamages'])